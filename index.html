<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Sculptor - Split Funds, Fund Goals</title>
    <meta name="description" content="Use the free Splitter tool to instantly allocate your income to your real financial goals. Track your progress and get inspired with daily wisdom.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Sora:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root { --font-family-body: 'Inter', sans-serif; --font-family-heading: 'Sora', sans-serif; --border-radius-lg: 24px; --border-radius-md: 16px; --border-radius-sm: 12px; --transition-fast: 0.2s; --transition-medium: 0.4s; --ease-out-quart: cubic-bezier(0.165, 0.84, 0.44, 1); }
        html[data-theme="light"] { --bg-color: #f4f5f7; --card-color: #ffffff; --text-color: #1a1a1a; --text-color-heading: #101010; --subtle-text-color: #5a5a6a; --border-color: rgba(0, 0, 0, 0.08); --shadow-color: rgba(90, 90, 120, 0.1); --accent-color: #6C63FF; --accent-glow: rgba(108, 99, 255, 0.3); --input-bg: #f0f2f5; --slider-track: #e4e4e7; --modal-bg: #ffffff; --success-color: #00A383; --error-color: #D32F2F; --strategy-btn-inactive-bg: #FFFFFF; --strategy-btn-inactive-color: #5a5a6a;}
        html[data-theme="dark"] { --bg-color: #1A1A22; --card-color: #242430; --text-color: #e0e0e5; --text-color-heading: #ffffff; --subtle-text-color: #9090a0; --border-color: rgba(255, 255, 255, 0.1); --shadow-color: rgba(0, 0, 0, 0.4); --accent-color: #8179ff; --accent-glow: rgba(129, 121, 255, 0.4); --input-bg: #32323D; --slider-track: #40404C; --modal-bg: #19191D; --success-color: #00C9B1; --error-color: #EF5350; --strategy-btn-inactive-bg: #2A2A33; --strategy-btn-inactive-color: #9090a0;}
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: var(--font-family-body); background-color: var(--bg-color); color: var(--text-color); display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; padding: 2rem; }
        .main-container { width: 100%; max-width: 900px; background: var(--card-color); backdrop-filter: blur(40px); border-radius: var(--border-radius-lg); border: 1px solid var(--border-color); box-shadow: 0 16px 40px -12px var(--shadow-color); padding: 2.5rem 3rem; }
        header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 1.5rem; margin-bottom: 2rem; border-bottom: 1px solid var(--border-color); }
        .app-logo { font-family: var(--font-family-heading); font-size: 1.75rem; color: var(--accent-color); text-decoration: none; }
        nav { display: flex; gap: 1.5rem; } nav a { text-decoration: none; color: var(--subtle-text-color); font-weight: 500; } nav a.active { color: var(--accent-color); font-weight: 600; } .premium-nav-link::after { content: '👑'; font-size: 0.7em; margin-left: 0.5em; }
        .header-right { display: flex; align-items: center; gap: 1rem; }
        .currency-selector-wrapper select { -webkit-appearance: none; appearance: none; background-color: var(--input-bg); border: 1px solid var(--border-color); padding: 8px 32px 8px 12px; border-radius: var(--border-radius-sm); color: var(--text-color); cursor: pointer; font-family: var(--font-family-body); font-weight: 500; }
        .currency-selector-wrapper::after { content: '▾'; position: absolute; right: 12px; top: 50%; transform: translateY(-50%); pointer-events: none; }
        .theme-switcher { background-color: var(--input-bg); border: 1px solid var(--border-color); border-radius: 50%; cursor: pointer; width: 36px; height: 36px; display: grid; place-items: center; font-size: 1.2rem;}
        .btn-primary { background: var(--accent-color); color: white; border: none; padding: 0.8rem 1.6rem; border-radius: var(--border-radius-sm); font-weight: 600; cursor: pointer; }
        .page-section { display: none; } .page-section.active { display: block; animation: fadeIn 0.4s; } @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .page-header { margin-bottom: 2rem; text-align: center; }
        .page-header h1 { font-family: var(--font-family-heading); font-size: 2.5rem; }
        footer { text-align: center; padding-top: 1.5rem; margin-top: 2.5rem; border-top: 1px solid var(--border-color); color: var(--subtle-text-color); }
        /* --- Splitter Specific --- V7 --- */
        #amount-display-wrapper { text-align: center; margin-bottom: 1rem; } #amount-display { font-size: 2.5rem; font-weight: 700; color: var(--accent-color); font-family: var(--font-family-heading); }
        .range-slider { -webkit-appearance: none; width: 100%; height: 12px; background: var(--slider-track); border-radius: 6px; outline: none; margin: 1rem 0;} .range-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 24px; height: 24px; background: #fff; border: 4px solid var(--accent-color); border-radius: 50%; cursor: pointer; }
        .strategy-selector { display:flex; justify-content: center; gap: 0.75rem; margin-bottom: 2rem; }
        .strategy-btn { background-color: var(--strategy-btn-inactive-bg); border: 1px solid var(--border-color); color: var(--strategy-btn-inactive-color); padding: 0.6rem 1.1rem; border-radius: var(--border-radius-sm); cursor: pointer; font-weight: 500; }
        .strategy-btn.active { background-color: var(--accent-color); color: white; border-color: var(--accent-color); font-weight: 600; }
        .split-result-card { border: 1px solid var(--border-color); border-radius: var(--border-radius-md); }
        .split-category-row { display: grid; grid-template-columns: 1fr auto auto; align-items: center; gap: 1rem; padding: 1rem 1.5rem; position: relative; }
        .assign-popup { display: none; position: absolute; background-color: var(--modal-bg); border-radius: var(--border-radius-md); box-shadow: 0 8px 20px var(--shadow-color); z-index: 100; padding: 0.5rem; width: max-content; right: 0; bottom: 50px; } /* V7 Clipping Fix */
        .assign-popup.active { display: block; } .assign-popup-item:hover { background-color: var(--input-bg); }
        #custom-split-total { text-align: right; margin-top: 1rem; font-weight: bold; }
        #custom-split-total.error { color: var(--error-color); }
        /* --- Goals Specific --- V7 --- */
        #sculptor-wisdom { text-align: center; color: var(--subtle-text-color); margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border-color); }
        .goals-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem; }
        .goal-card { background: var(--card-color); border: 1px solid var(--border-color); border-radius: var(--border-radius-md); padding: 1.5rem; }
        .goal-card.foundry-card { grid-column: 1 / -1; background: var(--input-bg); }
        .progress-bar-container { position: relative; height: 8px; background-color: var(--slider-track); border-radius: 4px; }
        .behavioral-nudge { position: absolute; bottom: 12px; font-size: 0.75rem; font-weight: 600; white-space: nowrap; transform: translateX(-50%); transition: left .4s ease; }
        .goal-card-footer { display: flex; justify-content: space-between; font-size: 0.8rem; font-weight: 500; color: var(--subtle-text-color); margin-top: 0.5rem; }
        /* --- Modal V7 --- */
        .modal-content { max-width: 580px; position: relative; }
        .modal-close-btn { position: absolute; top: 1rem; right: 1rem; background: var(--input-bg); border-radius: 50%; width: 32px; height: 32px; cursor: pointer; }
        #goal-selector-grid { grid-template-columns: repeat(4, 1fr); gap: 1rem; }
    </style>
</head>
<body>
    <div class="main-container">
        <header><!-- Dynamically populated by JS --></header>
        <main>
            <section id="splitter" class="page-section active">
                <div class="page-header"><h1>Split Funds</h1></div>
                <div id="amount-display-wrapper"><span id="amount-display">$10,000</span></div>
                <input type="range" min="100" max="100000" value="10000" step="100" class="range-slider" id="profit-slider">
                <div class="input-group" style="text-align:center;"><label style="margin-bottom:1rem;">Choose a Strategy</label><div id="splitter-strategy-selector" class="strategy-selector"></div></div>
                <div id="splitter-allocation-container"></div>
            </section>
            <section id="goals" class="page-section">
                <div class="page-header" style="display:flex; justify-content:space-between; align-items:center;"><h1>Your Goals</h1><div><button id="export-btn" class="btn-primary" style="background:var(--input-bg); color:var(--text-color); margin-right: 0.5rem;">Export 👑</button><button class="btn-primary" id="add-goal-btn">New Goal</button></div></div>
                <div class="goals-grid" id="goals-grid-container"></div><div id="sculptor-wisdom"></div>
            </section>
        </main>
        <footer>© 2025 Crude Capital. <button id="reset-data-btn" style="all:unset;text-decoration:underline;cursor:pointer;">Reset</button></footer>
    </div>
    <!-- Modals -->
    <div class="modal-overlay" id="goal-modal"><div class="modal-content"><button class="modal-close-btn">&times;</button><div class="modal-header"><h2 id="goal-modal-title"></h2></div><div id="goal-chooser-view"></div><form id="goal-form-view"></form></div></div>
    <div class="modal-overlay" id="upgrade-modal"><div class="modal-content" style="text-align:center;"><div class="modal-header" style="justify-content:center;"><h2 id="upgrade-title"></h2></div><p id="upgrade-message"></p><div class="modal-actions" style="justify-content:center;"><button class="btn-primary" id="upgrade-now-btn"></button></div></div></div>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const App = {
        state: { currentPage: 'splitter', currency: 'USD', goals: [], splitter: { total: 10000, activeStrategy: 'balanced', customSplit: { cash: 34, savings: 33, investments: 33 } }},
        config: {
            STORAGE_KEY: 'financialSculptorV7.data', MAX_FREE_GOALS: 2,
            WISDOM_QUOTES: ["The goal isn't more money. The goal is living life on your own terms.","A budget is telling your money where to go instead of wondering where it went.","Compound interest is the eighth wonder of the world. He who understands it, earns it; he who doesn't, pays it.","Don't save what is left after spending; spend what is left after saving.","An investment in knowledge pays the best interest.","You must gain control over your money or the lack of it will forever control you.","Beware of little expenses. A small leak will sink a great ship.","Investing should be more like watching paint dry or watching grass grow. If you want excitement, take $800 and go to Las Vegas.","Every time you borrow money, you're robbing your future self."],
            SplitterStrategies: { classic: { name: "Classic", split: { cash: 60, savings: 30, investments: 10 } }, balanced: { name: "Balanced", split: { cash: 30, savings: 40, investments: 30 } }, growth: { name: "Growth", split: { cash: 10, savings: 20, investments: 70 } }, custom: { name: "Custom" } },
            SplitterCategories: { cash: { title: 'Cash'}, savings: { title: 'Savings'}, investments: { title: 'Investments'}},
            GoalTemplates: {
                free: [{ id: 'emergency_fund', name: 'Emergency Fund', icon: '🛡️', type: 'cash'}, { id: 'house_payment', name: 'House Payment', icon: '🏠', type: 'savings'}, { id: 'investment_portfolio', name: 'Investments', icon: '📈', type: 'investments'}, {id: 'custom', name: 'Custom Goal', icon: '✨', type: 'custom'}],
                premium: [{ id: 'education', name: 'Education', icon: '🎓'}, { id: 'business', name: 'New Business', icon: '🚀'}]
            }
        },
        init() { this.cacheDom(); this.loadState(); this.applyTheme(localStorage.getItem('fsculpt.theme')||'dark'); this.setCurrency(this.state.currency,true); this.renderAll(); this.bindEvents(); this.navigateTo(window.location.hash.substring(1)||'splitter'); },
        cacheDom() {
            document.querySelector('header').innerHTML = `<div class="header-left"><a href="#splitter" class="app-logo">Financial Sculptor</a><nav><a href="#splitter" class="nav-link active">Splitter</a><a href="#goals" class="nav-link">Goals</a><a href="#studio" class="nav-link premium-nav-link">Studio</a></nav></div><div class="header-right"><div class="currency-selector-wrapper"><select id="currency-picker"><option value="USD">$ USD</option><option value="GBP">£ GBP</option><option value="EUR">€ EUR</option></select></div><button id="theme-switcher" class="theme-switcher">☀️</button></div>`;
            this.DOM = {html:document.documentElement, navLinks:document.querySelectorAll('nav a'), pages:document.querySelectorAll('.page-section'), currencyPicker:document.getElementById('currency-picker'), themeSwitcher:document.getElementById('theme-switcher'), amountDisplay:document.getElementById('amount-display'), profitSlider:document.getElementById('profit-slider'), splitterStrategySelector:document.getElementById('splitter-strategy-selector'), splitterAllocationContainer:document.getElementById('splitter-allocation-container'), goalsGrid:document.getElementById('goals-grid-container'), addGoalBtn:document.getElementById('add-goal-btn'), exportBtn:document.getElementById('export-btn'), wisdomContainer:document.getElementById('sculptor-wisdom'), goalModal:document.getElementById('goal-modal'), goalModalTitle:document.getElementById('goal-modal-title'), goalChooser:document.getElementById('goal-chooser-view'), goalForm:document.getElementById('goal-form-view'), upgradeModal:document.getElementById('upgrade-modal'), upgradeTitle:document.getElementById('upgrade-title'), upgradeMessage:document.getElementById('upgrade-message'), upgradeBtn:document.getElementById('upgrade-now-btn'), resetBtn:document.getElementById('reset-data-btn') };
        },
        renderAll() { this.renderSplitter(); this.renderGoals(); this.renderWisdomQuote(); },
        bindEvents() {
            this.DOM.navLinks.forEach(l => l.addEventListener('click', e => this.navigateTo(e.target.hash.substring(1))));
            this.DOM.themeSwitcher.addEventListener('click', () => this.applyTheme(this.DOM.html.dataset.theme === 'dark' ? 'light' : 'dark'));
            this.DOM.currencyPicker.addEventListener('change', e => this.setCurrency(e.target.value));
            this.DOM.resetBtn.addEventListener('click', () => { if(confirm("This will erase all your goals. Are you sure?")) {localStorage.clear(); window.location.reload();}});
            this.DOM.profitSlider.addEventListener('input', e => {this.state.splitter.total=parseFloat(e.target.value);this.DOM.amountDisplay.textContent=this.formatCurrency(this.state.splitter.total);this.renderSplitter();});
            this.DOM.profitSlider.addEventListener('change', () => this.saveState()); // V7 Change: Save state only when slider is released
            this.DOM.splitterStrategySelector.addEventListener('click', e => { if (e.target.closest('.strategy-btn')) this.applySplitterStrategy(e.target.dataset.strategy); });
            this.DOM.splitterAllocationContainer.addEventListener('input', e => { if (e.target.matches('.custom-slider')) this.handleCustomSliderInput(e); });
            this.DOM.splitterAllocationContainer.addEventListener('click', e => { if (e.target.matches('.assign-btn')) this.toggleGoalTargetPopup(e.target); });
            this.DOM.addGoalBtn.addEventListener('click', () => this.openGoalModal());
            this.DOM.exportBtn.addEventListener('click', () => this.showUpgradeModal('Export Your Goals', 'Premium users will be able to export their goal history to a CSV file.'));
            this.DOM.goalModal.addEventListener('click', e => { if (e.target.matches('.modal-overlay, .modal-close-btn')) this.closeGoalModal(); });
            document.addEventListener('click', e => { if (!e.target.closest('.assign-btn')) document.querySelectorAll('.assign-popup').forEach(p => p.classList.remove('active')); });
        },
        saveState() { localStorage.setItem(this.config.STORAGE_KEY, JSON.stringify(this.state)) },
        loadState() { const saved = localStorage.getItem(this.config.STORAGE_KEY); if (saved) {this.state = JSON.parse(saved);} if(!this.state.goals.find(g => g.id === 'goal_foundry')) {this.state.goals.unshift({id: 'goal_foundry', name: 'Foundry 🏦', current: 0, target: 1, isPermanent: true, type: 'cash'}); this.saveState();} },
        navigateTo(pageId) { if(pageId === 'studio') {this.showUpgradeModal("Strategy Studio", "Advanced portfolio & financial planning tools are coming soon."); return;} if(!['splitter', 'goals'].includes(pageId)) pageId = 'splitter'; this.state.currentPage = pageId; this.DOM.pages.forEach(p => p.classList.toggle('active', p.id === pageId)); this.DOM.navLinks.forEach(l => l.classList.toggle('active', l.hash === `#${pageId}`)); },
        applyTheme(theme) {this.DOM.html.dataset.theme = theme; this.DOM.themeSwitcher.textContent = theme === 'dark' ? '☀️' : '🌙'; localStorage.setItem('fsculpt.theme', theme)},
        setCurrency(currencyCode, isInitial = false) {this.state.currency = currencyCode; this.DOM.currencyPicker.value = currencyCode; this.DOM.profitSlider.value = this.state.splitter.total; this.DOM.amountDisplay.textContent = this.formatCurrency(this.state.splitter.total); if(!isInitial){this.saveState(); this.renderAll()}},
        formatCurrency(a) {try{return new Intl.NumberFormat(undefined,{style:'currency',currency:this.state.currency,currencyDisplay:'symbol'}).format(a||0).replace(/[A-Z]{2,3}/,'').trim()}catch(e){return `$${(a||0).toFixed(2)}`}},
        renderWisdomQuote() {const d=Math.floor((new Date-new Date(new Date().getFullYear(),0,0))/864e5); this.DOM.wisdomContainer.innerHTML = `<em>"${this.config.WISDOM_QUOTES[d % this.config.WISDOM_QUOTES.length]}"</em>`;},
        renderSplitter() {
            this.DOM.splitterStrategySelector.innerHTML = Object.entries(this.config.SplitterStrategies).map(([k, {name}]) => `<button class="strategy-btn ${k === this.state.splitter.activeStrategy ? 'active':''}" data-strategy="${k}">${name}</button>`).join('');
            const isCustom = this.state.splitter.activeStrategy === 'custom'; let customSlidersHTML = ''; let resultHTML = '';
            if (isCustom) {
                const total = Object.values(this.state.splitter.customSplit).reduce((s,v)=>s+v,0);
                customSlidersHTML = Object.entries(this.state.splitter.customSplit).map(([k,v]) => `<div><label>${this.config.SplitterCategories[k].title} (${v}%)</label><input type="range" class="custom-slider range-slider" data-key="${k}" value="${v}"></div>`).join('') + `<div id="custom-split-total" class="${total === 100 ? '' : 'error'}">Total: ${total}%</div>`;
            }
            const split = isCustom ? this.state.splitter.customSplit : this.config.SplitterStrategies[this.state.splitter.activeStrategy].split;
            resultHTML = `<div class="split-result-card">${Object.entries(this.config.SplitterCategories).map(([k, {title}]) => { const amount = this.state.splitter.total * (split[k] / 100); return `<div class="split-category-row"><span>${title}</span><strong>${this.formatCurrency(amount)}</strong><div style="position:relative;"><button class="assign-btn" data-category="${k}" data-amount="${amount}">Assign →</button><div class="assign-popup" id="popup-${k}"></div></div></div>` }).join('')}</div>`;
            this.DOM.splitterAllocationContainer.innerHTML = customSlidersHTML + resultHTML;
        },
        applySplitterStrategy(key) { this.state.splitter.activeStrategy = key; this.saveState(); this.renderSplitter(); },
        handleCustomSliderInput(e) {
            const updatedKey = e.target.dataset.key;
            let newValue = parseInt(e.target.value, 10);
            this.state.splitter.customSplit[updatedKey] = newValue;
            this.renderSplitter(); // Re-render to show updated percentages
        },
        toggleGoalTargetPopup(button) {
            const category=button.dataset.category, amount=parseFloat(button.dataset.amount), popup=document.getElementById(`popup-${category}`);
            const targetGoals = this.state.goals.filter(g => g.type === category && g.current < (g.target || Infinity));
            popup.innerHTML = targetGoals.length > 0 ? targetGoals.map(g => `<div class="assign-popup-item" data-goal-id="${g.id}">${g.name}</div>`).join('') : `<div class="assign-popup-item create-goal-prompt">Create a new goal...</div>`;
            if (targetGoals.length === 0) { popup.querySelector('.create-goal-prompt').addEventListener('click', () => { document.querySelectorAll('.assign-popup').forEach(p => p.classList.remove('active')); this.openGoalModal(); }); }
            else { popup.querySelectorAll('.assign-popup-item').forEach(i => i.addEventListener('click', e => this.assignFundsToGoal(e.target.dataset.goalId, amount))); }
            document.querySelectorAll('.assign-popup').forEach(p => { if (p !== popup) p.classList.remove('active'); });
            popup.classList.toggle('active');
        },
        assignFundsToGoal(goalId, amount) { const g = this.state.goals.find(g => g.id === goalId); if(g) {g.current += amount} this.saveState(); this.renderAll(); document.querySelectorAll('.assign-popup').forEach(p => p.classList.remove('active')); },
        renderGoals() {
            const userGoals = this.state.goals.filter(g => !g.isPermanent); const foundry = this.state.goals.find(g => g.isPermanent);
            const foundryCard = `<div class="goal-card foundry-card"><h3>${foundry.name}</h3><div style="font-size:1.5rem;font-weight:600;margin:0.5rem 0;">${this.formatCurrency(foundry.current)}</div><p style="font-size:0.8rem;color:var(--subtle-text-color)">Your primary cash reserve. Use funds from here for new goals.</p></div>`;
            let goalsGridHTML = userGoals.length > 0 ? userGoals.map(g => { const p = g.target > 0 ? (g.current / g.target) * 100 : 0; const n = this.getBehavioralNudge(p); const o = p > 95 ? 'calc(95% - 40px)' : `calc(${p}% - 20px)`; return `<div class="goal-card"><h3>${g.name}</h3><div>${this.formatCurrency(g.current)} / <span style="color:var(--subtle-text-color)">${this.formatCurrency(g.target)}</span></div><div class="progress-bar-container"><div class="progress-bar" style="width:${Math.min(100,p)}%;"></div><div class="behavioral-nudge" style="left:${o};">${n}</div></div><div class="goal-card-footer"><span>Progress</span><span>${p.toFixed(0)}%</span></div></div>`; }).join('') : `<p style="grid-column:1/-1;text-align:center;padding:2rem;color:var(--subtle-text-color)">Click 'New Goal' to begin your journey!</p>`;
            this.DOM.goalsGrid.innerHTML = foundryCard + goalsGridHTML;
        },
        getBehavioralNudge(p) { if(p >= 100) return "Accomplished! 🎉"; if(p >= 90) return "Almost there!"; if(p >= 75) return "Great progress!"; if(p >= 50) return "Halfway!"; if(p >= 25) return "Good start!"; return ""; },
        openGoalModal() { if (this.state.goals.filter(g => !g.isPermanent).length >= this.config.MAX_FREE_GOALS) {this.showUpgradeModal(`Goal Limit Reached`, `You've hit the ${this.config.MAX_FREE_GOALS} goal limit.`); return;} this.showGoalChooser(); this.DOM.goalModal.classList.add('active'); },
        closeGoalModal() { this.DOM.goalModal.classList.remove('active'); this.DOM.goalForm.style.display = 'none'; this.DOM.goalChooser.style.display = 'block'; this.DOM.goalForm.innerHTML = ''; },
        showGoalChooser() {
            this.DOM.goalModalTitle.textContent="Choose Your Next Financial Goal"; this.DOM.goalChooser.style.display = 'block'; this.DOM.goalForm.style.display = 'none';
            this.DOM.goalChooser.innerHTML = `<div class="modal-section-header">Free Goals</div><div id="goal-selector-grid" style="display:grid; grid-template-columns: repeat(4, 1fr); gap: 1rem;">${this.config.GoalTemplates.free.map(t => `<button class="goal-template-btn" data-id="${t.id}"><span class="icon">${t.icon}</span><span>${t.name}</span></button>`).join('')}</div><div class="modal-section-header" style="margin-top:1.5rem">Premium Collection</div><div id="premium-collection-grid" class="premium-collection-grid" style="border: 2px solid var(--input-bg); transition: border-color .2s ease;"><div class="icons" style="filter: blur(4px); margin-bottom: 1rem;"><span>🚀🎓✈️❤️‍🩹🌳</span></div><span>👑 Upgrade (Coming Soon)</span></div>`;
            this.DOM.goalChooser.querySelector('#goal-selector-grid').addEventListener('click', e => {const b = e.target.closest('.goal-template-btn'); if(b)this.showGoalForm(b.dataset.id)});
            this.DOM.goalChooser.querySelector('#premium-collection-grid').addEventListener('click', () => this.showUpgradeModal('Premium Goals', 'Our full suite of goal templates is coming soon.'));
        },
        showGoalForm(templateId) {
            const t = this.config.GoalTemplates.free.find(t => t.id === templateId); this.DOM.goalChooser.style.display = 'none'; this.DOM.goalForm.style.display = 'block'; this.DOM.goalModalTitle.textContent = `Create: ${t.name}`;
            const typeSelector = t.type === 'custom' ? `<div class="input-group"><label>Goal Type</label><select id="goal-type" style="width:100%;padding:0.75rem;background:var(--input-bg);border:1px solid var(--border-color);border-radius:var(--border-radius-sm)"><option value="cash">Cash</option><option value="savings" selected>Savings</option><option value="investments">Investments</option></select></div>` : '';
            this.DOM.goalForm.innerHTML=`<input type="hidden" id="goal-template-id" value="${t.id}"><input type="hidden" id="goal-type-hidden" value="${t.type}">${typeSelector}<div class="input-group"><label for="goal-name">Goal Name</label><input type="text" id="goal-name" required value="${t.id==='custom'?'':t.name}"></div><div class="input-group"><label for="target-amount">Target Amount</label><input type="number" id="target-amount" required></div><div class="modal-actions" style="margin-top:1.5rem"><button type="button" class="btn-secondary" id="back-to-templates-btn" style="background:var(--input-bg);color:var(--text-color);border:1px solid var(--border-color);">Back</button><button type="submit" class="btn-primary">Create Goal</button></div>`;
            this.DOM.goalForm.querySelector('#back-to-templates-btn').addEventListener('click', () => this.showGoalChooser());
            this.DOM.goalForm.querySelector(t.id === 'custom' ? '#goal-name' : '#target-amount').focus();
        },
        handleGoalFormSubmit(e) {
            e.preventDefault(); const form = e.target, templateId = form.querySelector('#goal-template-id').value;
            const newGoal = { id:`goal_${Date.now()}`, templateId, name:form.querySelector('#goal-name').value, target:parseFloat(form.querySelector('#target-amount').value), current:0, type:templateId==='custom'?form.querySelector('#goal-type').value:form.querySelector('#goal-type-hidden').value };
            this.state.goals.push(newGoal); this.saveState(); this.renderAll(); this.closeGoalModal();
        },
        showUpgradeModal(title, message) { const m = this.DOM.upgradeModal; m.querySelector('h2').textContent=title; m.querySelector('p').textContent=message; m.querySelector('.btn-primary').textContent='Upgrade (Coming Soon)'; m.classList.add('active'); m.addEventListener('click', e => { if (e.target.matches('.modal-overlay')) e.currentTarget.classList.remove('active'); }); m.querySelector('.btn-primary').addEventListener('click', () => {}, { once: true }); }
    };
    App.init();
});
</script>
</body>
</html>
